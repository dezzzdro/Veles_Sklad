Техническое задание: Veles_Sklad

ВЕРСИЯ: 1.0
ДАТА СОСТАВЛЕНИЯ: [05.09.2025]

ЧАСТЬ 1. ОБЩИЕ СВЕДЕНИЯ О ПРОЕКТЕ

Название приложения: Велес Склад
Цель: Учёт складских операций, прихода, выдачи, сборки, контрагентов и уведомлений.

Технологический стек:
- Фронтенд: HTML, JavaScript
- Фреймворк: Bootstrap 5
- Иконки: Font Awesome
- Хостинг фронтенда: Vercel
- База данных: Supabase (PostgreSQL)
- Терминал разработки: Git Bash

ЧАСТЬ 2. ИНФРАСТРУКТУРА И ДОСТУПЫ

Репозиторий GitHub:
- Владелец: dezzzdro
- Email: dezzzdro@gmail.com
- HTTPS: https://github.com/dezzzdro/Veles_Sklad.git
- SSH: git@github.com:dezzzdro/Veles_Sklad.git
- CLI: gh repo clone dezzzdro/Veles_Sklad

Supabase:
- Project URL: https://tqwagbbppfklqgmyyrwj.supabase.co
- API Key (anon/public): eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxd2FnYmJwcGZrbHFnbXl5cndqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1Mjk2MjAsImV4cCI6MjA3MTEwNTYyMH0.C4d6-aNDisajHcg7lurnRHdbk-pe3AvE4AIaW_e53eE

ЧАСТЬ 3. ПОЛЬЗОВАТЕЛЬСКИЙ ИНТЕРФЕЙС (UI)

Общие требования:
- Название "Велес Склад" отображается ТОЛЬКО в шапке приложения. Нигде больше не должно встречаться.
- Функции раздела, если есть таблица, располагаются систематизированными блооками по функциональности между шапкой приложения и заголовком таблицы.
- Гармоничное логичное расположение элемнтов относистельно друг друга для улучшения читаемости.
- В шапке отображаются текущие часы и дата.
- В шапке — три иконки для смены цветовой схемы (темы оформления).
- Боковая панель навигации содержит разделы:
    1. Склад
    2. Сборка
    3. Приход
    4. Выданное
    5. Контрагенты
    6. Настройки
    7. Уведомления
    8. Инструмент отладки

Правило оформления UI:
- Все элементы интерфейса (таблицы, кнопки, формы, модальные окна) должны иметь единый стиль.
- Использовать одну цветовую палитру, единый набор шрифтов и одинаковую систему отступов.
- Логика размещения элементов: кнопки действий всегда справа сверху, фильтры и поиск — слева сверху, модальные окна по центру.
- Таблицы должны иметь одинаковое оформление заголовков и строк.
- Формы должны содержать метки над полями и кнопку подтверждения внизу справа.
- Использовать адаптивную вёрстку, корректное отображение на десктопе и мобильных устройствах.

# Промт: Единые правила оформления таблиц в веб-приложении Veles_Sklad

## ОБЩИЕ ПРАВИЛА РАСПОЛОЖЕНИЯ

1. **ВСЕ элементы управления (кнопки, фильтры, инструменты) ДОЛЖНЫ находиться ТОЛЬКО выше заголовка таблицы**
2. **НИКАКИХ элементов управления НЕТ под таблицей**
3. **СТРОГОЕ соблюдение одинаковой структуры для ВСЕХ таблиц во всех разделах приложения**

## СТРУКТУРА БЛОКОВ НАД ТАБЛИЦЕЙ (СВЕРХУ ВНИЗ)

### Блок 1: Основные действия (в правой части)
- Расположение: прижато к правому краю
- Требования к кнопкам:
  * Минимальная высота: 40px
  * Горизонтальные отступы: 16px
  * Иконка слева от текста (размер 18px, отступ 8px)
  * Размер шрифта: 14px, жирное начертание

### Блок 2: Фильтрация данных
- Расположение: занимает всю ширину над таблицей
- Состав:
  * Индивидуальные фильтры для КАЖДОЙ колонки таблицы
- Требования к фильтрам:
  * Высота: 36px
  * Тип фильтра зависит от типа данных колонки (текст, число, дата, выбор)
  * Фильтрация в реальном времени с задержкой 300мс

## ТРЕБОВАНИЯ К ТАБЛИЦЕ

1. **Заголовок таблицы:**
   - Высота: 45px
   - Фон: #f8f9fa
   - Шрифт: жирный

2. **Тело таблицы:**
   - Высота строки: 40px
   - Чередующаяся подсветка строк
   - При наведении: легкий серый фон
   - Кнопки действий: только в крайней правой колонке, иконки 16px

3. **Адаптивность:**
   - Корректное отображение на мобильных устройствах
   - При узком экране скрывать наименее важные колонки
   - Поддержка сортировки по клику на заголовок

## ЦВЕТОВАЯ СХЕМА КНОПОК

- Основные действия (добавить, обновить): синий (#0d6efd)
- Второстепенные действия (очистить, экспорт): серый (#6c757d)
- Опасные действия (удалить): красный (#dc3545)
- Подтверждающие действия (применить): зеленый (#198754)

## ЗАПРЕЩЕНО

- Размещать кнопки под таблицей
- Использовать разные стили кнопок в разных разделах
- Размещать фильтры под таблицей или внутри таблицы
- Применять разные высоты строк в разных разделах
- Использовать разные цвета для одинаковых действий

## ПРИМЕР СТРУКТУРЫ ДЛЯ ЛЮБОГО РАЗДЕЛА

[КНОПКИ ДЕЙСТВИЙ В ПРАВОМ ВЕРХНЕМ УГЛУ]
[СПЕЦИФИЧЕСКИЕ ИНСТРУМЕНТЫ ДЛЯ РАЗДЕЛА (ЕСЛИ НУЖНО)]
[ФИЛЬТРЫ ПО ВСЕМ КОЛОНКАМ]
[ЗАГОЛОВОК ТАБЛИЦЫ]
[СОДЕРЖИМОЕ ТАБЛИЦЫ С ЕДИНООБРАЗНЫМ ФОРМАТИРОВАНИЕМ]

СЛЕДУЙ ЭТИМ ПРАВИЛАМ ПРИ ЛЮБОМ ИЗМЕНЕНИИ ИНТЕРФЕЙСА. НЕ ДОБАВЛЯЙ НОВЫЕ ЭЛЕМЕНТЫ В ДРУГИЕ МЕСТА. НЕ ИЗМЕНЯЙ ЭТУ СТРУКТУРУ.

ЧАСТЬ 4. ФУНКЦИОНАЛЬНЫЕ МОДУЛИ

МОДУЛЬ 1. СКЛАД

Назначение: Отображение текущего состояния склада.

Колонки таблицы:
- ID — уникальный сгенерированный код товара
- Наименование — название товара
- Ед.изм. — единицы измерения
- Числится — количество по бухгалтерии
- На складе — фактическое наличие
- Выдано — количество, выданное со склада

Функционал:
- Фильтрация по каждой колонке.

МОДУЛЬ 2. СБОРКА

Назначение: Подготовка товаров к передаче в производство/сборку.

Колонки таблицы:
- ID — уникальный сгенерированный код товара
- Наименование — название товара
- Ед.изм. — единицы измерения
- Количество — количество для передачи в сборку

Функционал:
- Принцип CRUD (создание, чтение, обновление, удаление).
- Фильтрация по каждой колонке.
- Кнопки над таблицей:
    - "Обновить" — обновляет данные таблицы.
- Кнопки на строке:
    - "Редактировать" — редактирует: наименование, ед.изм., Числится, На складе, Выдано.
    - "Удалить строку" — удаляет запись.
    - "Передать в сборку" — открывает модальное окно с:
        - Именем товара
        - Значениями: Числится, На складе
        - Расчётным полем: "Остаток после выдачи" = На складе - Количество передачи
        - Полем ввода: количество для передачи в сборку

МОДУЛЬ 3. ПРИХОД

Назначение: Приёмка товаров на склад.

Колонки таблицы:
- Дата — автоматически при записи
- Наименование — название товара
- Ед.изм. — единицы измерения
- Количество — принимаемое количество
- Реестровый номер — номер документа
- УПД — номер УПД

Функционал:
- Фильтрация по всем колонкам.

Секции управления над таблицей:

Секция 1: "Принятие прихода"
- "Вставить из буфера обмена" — вставляет данные в колонки: Наименование, Ед.изм., Количество.
- "Импорт из xlsx" — импортирует с первого листа Excel-файла данные в колонки: Наименование, Ед.изм., Количество.
- "Добавить строку" — добавляет пустую строку для ручного заполнения.
- "Принять" — переносит заполненные строки в таблицу "Склад":
    - При совпадении наименования — суммирует значения "Числится" и "На складе".
    - При отсутствии — создаёт новую строку, перенося "Количество" в "Числится" и "На складе".
    - Записывает операцию в таблицу "Операции" с типом "Принятый приход", указанием даты и времени.

Секция 2: "Документы прихода"
- Поле ввода + кнопка "Реестровый номер заявки" — значение записывается в строки, где заполнено "Наименование".
- Поле ввода + кнопка "УПД" — аналогично, заполняет строки с заполненным "Наименование".

Секция 3: "Редактирование"
- "Очистить приход" — очищает все строки таблицы.
- "Экспорт в xlsx" — сохраняет данные в файл с именем "Приход_YYYY-MM-DD.xlsx".

МОДУЛЬ 4. ВЫДАННОЕ

Назначение: Учёт выданных товаров контрагентам.

Колонки таблицы:
- Дата — время и дата выдачи
- ID — уникальный код товара
- Наименование — название товара
- Ед.изм. — единицы измерения
- Количество — выданное количество
- Контрагент — название организации
- Ответственный — ФИО ответственного лица
- Реестровый номер — номер документа
- УПД — номер УПД

Функционал:
- Фильтрация по: Дата, ID, Наименование, Реестровый номер, УПД.
- Выпадающие списки: "Контрагент", "Ответственный".

МОДУЛЬ 5. КОНТРАГЕНТЫ

Назначение: Управление списком организаций и их представителей.

Формат отображения:
- Карточки с названием организации.
- В каждой карточке — список ответственных лиц.

Функционал:
- Принцип CRUD (создание, чтение, обновление, удаление).

МОДУЛЬ 6. НАСТРОЙКИ

Назначение: Управление внешним видом приложения.

Функционал:
- Выбор цветовой схемы (темы оформления).

МОДУЛЬ 7. УВЕДОМЛЕНИЯ

Назначение: Просмотр и настройка системы уведомлений.

Колонки таблицы:
- Дата — время события
- Тип уведомления — категория
- Текст уведомления — описание

Функционал:
- Фильтрация по каждой колонке.
- Настройка: включение/отключение уведомлений.
- Пояснение значений символов (если используются иконки или коды).

МОДУЛЬ 8. ИНСТРУМЕНТ ОТЛАДКИ

Назначение: Тестирование и диагностика работы с СУБД.

## 1. ОСНОВНАЯ ЦЕЛЬ

Создать простой, но эффективный инструмент отладки для проверки работоспособности соединения с Supabase и базовых операций с базой данных. Инструмент должен помочь разработчику быстро диагностировать проблемы с подключением и работой с базой данных в небольшом веб-приложении.

## 2. ОБЯЗАТЕЛЬНЫЕ ФУНКЦИИ

### 2.1. Проверка подключения к СУБД

- Кнопка "Проверить подключение"
- При нажатии выполняет:
  * Попытку подключения к Supabase с использованием текущих параметров
  * Проверку доступности таблицы "test_connection"
  * Измерение времени отклика
- Результат отображается цветом:
  * Зеленый - подключение успешно установлено
  * Желтый - подключение есть, но медленное (более 500мс)
  * Красный - подключение не установлено
- Под результатом отображается точное время отклика

### 2.2. Тестовые операции с данными

- Создать тестовую таблицу "debug_test" при первом запуске (если не существует)
  * Структура: id (uuid), created_at (timestamp), test_value (text)
- Кнопка "Тест записи":
  * Генерирует запись с текущим временем и текстом "Тестовая запись от [текущая дата]"
  * Отображает время выполнения операции
  * Показывает ID созданной записи
- Кнопка "Тест чтения":
  * Читает 5 последних записей из таблицы "debug_test"
  * Отображает их в таблице с колонками: ID, Дата создания, Значение
  * Показывает время выполнения операции

### 2.3. Стресс-тест (упрощенный)

- Кнопка "Стресс-тест" с настройками:
  * Количество запросов: поле ввода (по умолчанию 10)
  * Тип запроса: выпадающий список (запись/чтение)
- При нажатии выполняет указанное количество запросов
- Отображает:
  * Общее время выполнения
  * Среднее время одного запроса
  * Количество успешных/неуспешных запросов
  * График времени отклика для каждого запроса

## 3. СИСТЕМА ЛОГИРОВАНИЯ

### 3.1. Основные принципы

- Все операции с базой данных автоматически записываются в локальный лог
- Лог хранится в памяти браузера (localStorage) до 100 записей
- Каждая запись лога содержит:
  * Дату и время (точность до миллисекунд)
  * Тип операции (подключение, запись, чтение, ошибка)
  * Статус (успех, предупреждение, ошибка)
  * Описание операции
  * Время выполнения (для успешных операций)
  * Код ошибки и сообщение (для неудачных операций)

### 3.2. Просмотр лога

- Таблица лога с возможностью:
  * Фильтрации по типу операции
  * Фильтрации по статусу
  * Поиска по ключевым словам
  * Очистки лога
- Каждая ошибка выделена красным цветом
- Предупреждения выделены желтым цветом
- Успешные операции - серым цветом
- При наведении на запись лога показывается полная информация

### 3.3. Коды ошибок и рекомендации

Для основных ошибок предусмотрены понятные сообщения и рекомендации:

- Ошибка подключения (код DB_CONN_001):
  * Причина: Неверные параметры подключения или недоступность сервера
  * Решение: Проверьте Project URL и API Key в настройках приложения

- Ошибка авторизации (код DB_AUTH_002):
  * Причина: Неверный или просроченный API ключ
  * Решение: Обновите anon-ключ в настройках Supabase

- Ошибка таблицы (код DB_TABLE_003):
  * Причина: Отсутствует необходимая таблица
  * Решение: Проверьте структуру базы данных, возможно, требуется миграция

- Ошибка запроса (код DB_QUERY_004):
  * Причина: Некорректный SQL-запрос
  * Решение: Проверьте синтаксис запроса и структуру таблицы

## 4. ИНТЕРФЕЙС

### 4.1. Основная структура

- Верхняя панель: Кнопки основных действий (Проверить подключение, Тест записи, Тест чтения, Стресс-тест)
- Средняя область: Результаты последней операции с деталями
- Нижняя область: Лог операций с фильтрами и кнопками управления

### 4.2. Требования к интерфейсу

- Минималистичный дизайн в стиле всего приложения
- Четкая цветовая индикация статусов
- Адаптивный интерфейс для мобильных устройств
- Возможность свернуть/развернуть лог для удобства
- Простые и понятные подписи ко всем элементам

## 5. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ

### 5.1. Безопасность

- Все тестовые операции должны использовать отдельные тестовые таблицы
- Запрет на выполнение DDL-запросов (CREATE, ALTER, DROP)
- Автоматическая очистка ввода от потенциальных инъекций
- Логирование всех операций для аудита

### 5.2. Реализация

- Использовать существующие подключения к Supabase (без дублирования)
- Минимизировать дополнительные зависимости
- Все функции должны работать в рамках существующей архитектуры приложения
- Код должен быть хорошо задокументирован

## 6. ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ

Сценарий 1: Проверка работоспособности после деплоя
- Разработчик заходит в раздел отладки
- Нажимает "Проверить подключение"
- Видит статус подключения и время отклика
- При необходимости проверяет запись и чтение данных

Сценарий 2: Диагностика проблемы с медленной работой
- Разработчик запускает стресс-тест с 20 запросами
- Анализирует график времени отклика
- Определяет, есть ли проблема с конкретными запросами
- Проверяет лог для поиска ошибок или предупреждений

Сценарий 3: Поиск проблемы с подключением
- Разработчик видит красный статус подключения
- Проверяет лог и видит ошибку DB_CONN_001
- Следует рекомендации и проверяет параметры подключения
- После исправления повторно проверяет подключение

## 7. ПРОСТОЙ ПЛАН РЕАЛИЗАЦИИ

1. Создать тестовую таблицу debug_test при первом запуске
2. Реализовать функцию проверки подключения
3. Реализовать функции тестовой записи и чтения
4. Добавить упрощенный стресс-тест
5. Создать систему логирования с базовыми фильтрами
6. Разработать простой интерфейс с цветовой индикацией
7. Добавить справочные сообщения для основных ошибок

Это упрощенное ТЗ содержит только необходимый минимум функций для эффективной отладки небольшого складского приложения, с акцентом на простоту, практичность и продуманную систему логирования ошибок.

ЧАСТЬ 5. РАБОТА С БАЗОЙ ДАННЫХ (СУБД)

Общие требования:
- Все таблицы в Supabase должны иметь ТОЧНО такие же колонки, как описаны в соответствующих модулях приложения.
- На момент начала разработки база данных ПУСТА — таблицы отсутствуют.
- Приложение должно само инициализировать структуру таблиц при первом запуске или через миграции.

ЧАСТЬ 6. ПРАВИЛА ВЗАИМОДЕЙСТВИЯ ЧЕЛОВЕКА И ИИ (ДЛЯ РАЗРАБОТЧИКОВ И АССИСТЕНТОВ)

1. После получения полного контекста — предложить команду для создания файла TZ.md с актуальным содержимым в корне проекта. Нужно создать файл точь в точ, без сокращений содержимого.
2. Все команды, требующие определённого контекста каталога, должны включать переход в нужную папку: cd /путь && команда.
3. Максимально использовать терминал для всех операций (создание файлов, редактирование, git и т.д.). Если задача решается через терминал — предлагать именно терминальную команду.
4. Один запрос — один логический шаг. Не предлагать цепочки команд без проверки результата предыдущего шага.
5. При добавлении нового правила — генерировать команду для его добавления в файл TZ.md в корне проекта.
6. Если в разделах 1 или 2 (контекст проекта) не хватает критичной информации — предложить команду для её добавления в соответствующий файл (например, PROJECT_CONTEXT.md).
7. Предложить команду на git add, git commit с осмысленным сообщением и git push после каждого значимого изменения.
8. Всегда указывать на неточности, противоречия или риски в запросах пользователя.
9. Все ответы и размышление вести на русском языке.
10. Перед предложением следующей команды — убедиться, что результат предыдущей команды подтверждён пользователем.
11. В точности следовать инструкциям пользователя, не интерпретируя намерения.
12. Если команда может повредить системе (удаление, перезапись, chmod и т.п.) — явно предупреждать и рекомендовать проверить путь и содержимое перед выполнением.
13. Предлагать идемпотентные или безопасные в повторном запуске команды, где это возможно.
14. Не домысливать структуру проекта — запрашивать уточнения, если путь или контекст неясны.
15. Все команды предоставлять в готовом к копированию виде, с пояснением, что они делают.
16. По запросу — формировать скрипты или многострочные команды с правильным экранированием.
17. При работе с версиями, зависимостями или окружением — уточнять, как проверить текущее состояние (например, python --version, git status и т.д.).

ЧАСТЬ 7. ПРИМЕЧАНИЯ

- Исправлены опечатки: "xlxs" → "xlsx", "отвественный" → "ответственный".
- Исправлена нумерация модулей: приведена в соответствие с логикой навигации (Склад → Сборка → Приход → Выданное → ...).
- Все описания сохранены в полном объёме, без сокращений.
- Структура файла оптимизирована для чтения разработчиками, тестировщиками и аналитиками.